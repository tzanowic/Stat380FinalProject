---
title: "STAT 380 Final Project"
author: "Tristan Zanowic, Evan Spinney, Julian Sim"
output: html_notebook
---

# Front Matter

## Clear Environment
```{r}
# rm(list = ls())
```

## Library Calls
```{r}
library(tidyverse)
library(Lahman)
library(reshape2)
library(mdsr)
library(mvtnorm)
library(factoextra)
library(cluster)
library(leaps)
library(caret)
library(ISLR2)
library(ggrepel)
```

## Loading Data
```{r}
FullStats <- read.csv("FullStats.csv")
FullStats <-
  FullStats %>%
  rename(deathsper100000 = Deaths...cumulative.total.per.100000.population, casesper100000 = Cases...cumulative.total.per.100000.population)
head(FullStats)
VaccineData <- read.csv("vaccination-data.csv")
FullStats$gdpcap <- FullStats$gdpcap/1000
FullStats$AirTransport <- FullStats$AirTransport/1000
FullStats$HealthExppCap <- FullStats$HealthExppCap/100
```



# Exploratory Data Analysis

## COVID-19 Rates by Geographical Region
```{r}
FullStats %>%
  group_by(WHO.Region) %>%
  summarise(countries = n(), avgcovidcases = mean(totalcases), avgcoviddeaths = mean(totaldeaths), deathrate = (avgcoviddeaths/avgcovidcases))
```

## Exploring Death Rates vs Other Parameters
```{r}
FullStats %>%
  ggplot(aes(x = (gdpcap), y = deathrate, na.rm = TRUE)) +
  geom_point(aes(color = WHO.Region)) 
FullStats %>%
  ggplot(aes(x = (urbpop), y = deathrate, na.rm = TRUE)) +
  geom_point(aes(color = WHO.Region)) 
```

## Identifying Outliers

```{r}
is_outlier <- function(x) {
  return(x < quantile(x, 0.25, na.rm = TRUE) - 1.5 * IQR(x, na.rm = TRUE) | 
             x > quantile(x, 0.75, na.rm = TRUE) + 1.5 * IQR(x, na.rm = TRUE))
}
```

```{r}
temp <- FullStats %>%
    group_by(WHO.Region) %>%
    mutate(outlier = if_else(is_outlier(deathrate), Name, NA_character_),
           outlierBin = is_outlier(deathrate)) 
```


```{r}
# main graph
ggplot(data = temp, aes(x = factor(WHO.Region), y = deathrate, 
                        fill = factor(WHO.Region))) +
    geom_boxplot(aes(color = factor(WHO.Region)), show.legend = FALSE) +
    geom_boxplot(outlier.color = NA) +
    geom_text_repel(aes(label = outlier), nudge_y = 0.01, na.rm = TRUE, 
                    show.legend = FALSE,) +
    theme(
        # label stylings
        axis.text.x = element_text(angle = 30, vjust = 1, hjust = 1),
        plot.title = element_text(size = 15, face = "bold", hjust = 0.5)) +
    theme(
        # legend stylings
        legend.position = c(0.975, 0.95),
        legend.justification = c("right", "top"),
        legend.box.background = element_rect(color = "black")) +
    labs(title = "Death Rates across WHO Regions", 
         x = "Region", y = "Death Rate",
         fill = "Region")
```

## Multiple Linear Regression - Deaths per 100000

```{r}
# All Variables
deathrate.fit <- lm(data = FullStats, deathsper100000 ~ gdpcap + urbpop + HealthExppCap + AirTransport + AgeDependancy + MilitaryEx + HospitalBeds + PovertyRate, na.rm = TRUE)
summary(deathrate.fit)

# No Poverty Rate
deathrate2.fit <- lm(data = FullStats, deathsper100000 ~ gdpcap + urbpop + HealthExppCap + AirTransport + AgeDependancy + MilitaryEx + HospitalBeds, na.rm = TRUE)
summary(deathrate2.fit)

# No Air Transport
deathrate3.fit <- lm(data = FullStats, deathsper100000 ~ gdpcap + urbpop + HealthExppCap + AgeDependancy + MilitaryEx + HospitalBeds, na.rm = TRUE)
summary(deathrate3.fit)

# No MilitaryEx
deathrate4.fit <- lm(data = FullStats, deathsper100000 ~ gdpcap +urbpop + HealthExppCap + AgeDependancy + HospitalBeds, na.rm = TRUE)
summary(deathrate4.fit)

# No HealthExp
deathrate5.fit <- lm(data = FullStats, deathsper100000 ~ gdpcap + urbpop + AgeDependancy + HospitalBeds, na.rm = TRUE)
summary(deathrate5.fit)
```

```{r}

```


# Multiple Linear Regression - Cases Per 100000
```{r}
# Case Rate - All Vars
caserate.fit <- lm(data = FullStatsNA, casesper100000 ~  gdpcap + urbpop + HealthExppCap + AirTransport + AgeDependancy + MilitaryEx + HospitalBeds + PovertyRate, na.rm = TRUE)
summary(caserate.fit)



```